<Page
    x:Class="OkapiLauncher.Views.SettingsPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:controls="clr-namespace:CommunityToolkit.Mvvm.ComponentModel;assembly=CommunityToolkit.Mvvm"
    xmlns:converters="clr-namespace:OkapiLauncher.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:diag="clr-namespace:System.Diagnostics;assembly=WindowsBase"
    xmlns:i="http://schemas.microsoft.com/xaml/behaviors"
    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:mdicons="clr-namespace:Material.Icons.WPF;assembly=Material.Icons.WPF"
    xmlns:models="clr-namespace:OkapiLauncher.Models"
    xmlns:properties="clr-namespace:OkapiLauncher.Properties"
    xmlns:usercontrols="clr-namespace:OkapiLauncher.Controls"
    xmlns:vms="clr-namespace:OkapiLauncher.ViewModels"
    x:Name="RootPage"
    d:Background="Gray"
    d:DataContext="{d:DesignInstance IsDesignTimeCreatable=False,
                                     Type={x:Type vms:SettingsViewModel}}"
    d:DesignHeight="1200"
    d:DesignWidth="1200"
    Style="{DynamicResource MahApps.Styles.Page}"
    mc:Ignorable="d">
    <Page.Resources>
        <converters:EnumToBooleanConverter x:Key="EnumToBooleanConverter" EnumType="models:AppTheme" />
        <converters:BoolToVisibilityConverter x:Key="BoolToVisibilityConverter" />
        <converters:AppButtonToTextConverter x:Key="ButtonToTextConverter" />
        <converters:AppButtonToIconConverter x:Key="ButtonToIconConverter" />
        <converters:QuererTypeToDescriptionConverter x:Key="QuererToTextConverter" />
        <converters:QuererTypeToIconConverter x:Key="QuererToIconConverter" />

    </Page.Resources>
    <DockPanel>
        <TextBlock
            DockPanel.Dock="Top"
            Style="{StaticResource PageTitleStyle}"
            Text="{x:Static properties:Resources.SettingsPageTitle}" />
        <Grid x:Name="RootGrid" Margin="0,0,5,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition />
                <ColumnDefinition Width="2*" />
            </Grid.ColumnDefinitions>
            <Grid
                x:Name="RightGrid"
                Grid.Column="2"
                ScrollViewer.VerticalScrollBarVisibility="Disabled">
                <Grid.RowDefinitions>
                    <RowDefinition Height="auto" />
                    <RowDefinition Height="1*" />
                </Grid.RowDefinitions>
                <Grid
                    x:Name="SourcesGrid"
                    Grid.Row="1"
                    Margin="{StaticResource SmallTopBottomMargin}">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="auto" />
                        <RowDefinition Height="auto" />
                    </Grid.RowDefinitions>
                    <!--<TextBlock
                        Margin="{StaticResource SmallTopMargin}"
                        Style="{StaticResource SubtitleTextStyle}"
                        Text="{x:Static properties:Resources.SettingsPageCustomSourcesHeader}"
                        ToolTip="{x:Static properties:Resources.SettingsPageCustomSourcesTooltip}" />-->
                    <ScrollViewer Grid.Row="1">
                        <StackPanel>
                            <Border Style="{StaticResource SettingsItem}">
                                <StackPanel>
                                    <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{x:Static properties:Resources.SettingsPageButtonsHeader}" />
                                    <usercontrols:AvAppFacadeListItem
                                        Margin="{StaticResource XSmallBottomMargin}"
                                        AppFacade="{Binding AvAppFacadeDummy}"
                                        ButtonSettings="{Binding ButtonSettings}" />
                                    <Grid DataContext="{Binding ButtonSettingsVm}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="2*" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <StackPanel Grid.Column="1" Margin="{StaticResource SmallLeftMargin}">
                                            <CheckBox IsChecked="{Binding ShowDisabledButtons}">
                                                <TextBlock
                                                    Margin="{StaticResource SmallTopBottomMargin}"
                                                    Style="{StaticResource BodyTextStyle}"
                                                    Text="{x:Static properties:Resources.SettingsPageButtonsShowDisabled}" />
                                            </CheckBox>
                                            <Button
                                                Command="{Binding ResetCommand}"
                                                Content="{x:Static properties:Resources.SettingsPageButtonsReset}"
                                                Style="{StaticResource SettingsButton}" />
                                            <GroupBox
                                                BorderThickness="0"
                                                Header="{x:Static properties:Resources.AppButtonIconSize}"
                                                Style="{StaticResource MahApps.Styles.GroupBox.Clean}">
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="*" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <Slider
                                                        Margin="{StaticResource SmallLeftRightMargin}"
                                                        Maximum="75"
                                                        Minimum="25"
                                                        TickFrequency="5"
                                                        TickPlacement="BottomRight"
                                                        Value="{Binding IconSize}" />
                                                    <TextBlock
                                                        Grid.Column="1"
                                                        Margin="{StaticResource SmallLeftRightMargin}"
                                                        Style="{StaticResource BodyTextStyle}"
                                                        Text="{Binding IconSize}" />
                                                </Grid>
                                            </GroupBox>
                                        </StackPanel>
                                        <ListView
                                            Grid.Column="0"
                                            ItemsSource="{Binding ButtonOrdering}"
                                            ScrollViewer.CanContentScroll="False"
                                            ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                            <ListView.ItemTemplate>
                                                <DataTemplate>
                                                    <Grid Margin="2">
                                                        <Grid.ColumnDefinitions>
                                                            <ColumnDefinition Width="auto" />
                                                            <ColumnDefinition Width="25" />
                                                            <ColumnDefinition Width="*" />
                                                            <ColumnDefinition Width="50" />
                                                            <ColumnDefinition Width="50" />
                                                        </Grid.ColumnDefinitions>
                                                        <CheckBox IsChecked="{Binding Enabled}" />
                                                        <mdicons:MaterialIcon Grid.Column="1" Kind="{Binding Button, Converter={StaticResource ButtonToIconConverter}}" />
                                                        <TextBlock
                                                            Grid.Column="2"
                                                            Margin="{StaticResource XSmallLeftMargin}"
                                                            VerticalAlignment="Center"
                                                            Style="{StaticResource BodyTextStyle}"
                                                            Text="{Binding Button, Converter={StaticResource ButtonToTextConverter}}"
                                                            TextTrimming="CharacterEllipsis"
                                                            TextWrapping="NoWrap" />
                                                        <Button
                                                            Grid.Column="3"
                                                            Command="{Binding MoveUpCommand}"
                                                            Content="UP" />
                                                        <Button
                                                            Grid.Column="4"
                                                            Command="{Binding MoveDownCommand}"
                                                            Content="down" />
                                                    </Grid>
                                                </DataTemplate>
                                            </ListView.ItemTemplate>
                                        </ListView>
                                    </Grid>
                                </StackPanel>
                            </Border>
                            <Border Style="{StaticResource SettingsItem}" ToolTip="{x:Static properties:Resources.SettingsPageCustomSourcesTooltip}">
                                <StackPanel>
                                    <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{x:Static properties:Resources.SettingsPageCustomSourcesHeader}" />
                                    <ListView
                                        d:ItemsSource="{d:SampleData ItemCount=5}"
                                        ItemsSource="{Binding CustomSources}"
                                        ScrollViewer.HorizontalScrollBarVisibility="Disabled">
                                        <ListView.Style>
                                            <Style BasedOn="{StaticResource {x:Type ListView}}" TargetType="{x:Type ListView}">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={x:Static RelativeSource.Self}, Path=Items.Count}" Value="0">
                                                        <Setter Property="Template">
                                                            <Setter.Value>
                                                                <ControlTemplate>
                                                                    <TextBlock
                                                                        HorizontalAlignment="Center"
                                                                        VerticalAlignment="Top"
                                                                        Style="{StaticResource EmptyListPlaceholder}"
                                                                        Text="{x:Static properties:Resources.SettingsPageNoCustomSourceMessage}"
                                                                        ToolTip="{x:Static properties:Resources.SettingsPageCustomSourcesTooltip}" />
                                                                </ControlTemplate>
                                                            </Setter.Value>
                                                        </Setter>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </ListView.Style>
                                        <ListView.ItemTemplate>
                                            <DataTemplate>
                                                <Grid>
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition />
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="auto" />
                                                        <ColumnDefinition Width="auto" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid>
                                                        <Grid.RowDefinitions>
                                                            <RowDefinition Height="1*" />
                                                            <RowDefinition Height="1*" />
                                                        </Grid.RowDefinitions>
                                                        <TextBlock
                                                            Style="{StaticResource AppTitleStyle}"
                                                            Text="{Binding Description}"
                                                            TextTrimming="CharacterEllipsis"
                                                            TextWrapping="NoWrap"
                                                            ToolTip="{StaticResource SelfToolTipText}" />
                                                        <TextBlock
                                                            Grid.Row="1"
                                                            Style="{StaticResource BaseTextBlockStyle}"
                                                            Text="{Binding Path}"
                                                            TextTrimming="CharacterEllipsis"
                                                            TextWrapping="NoWrap"
                                                            ToolTip="{Binding SourcePath}" />
                                                    </Grid>
                                                    <Button
                                                        Grid.Column="2"
                                                        Command="{Binding ElementName=RootPage, Path=DataContext.EditSourceCommand}"
                                                        CommandParameter="{Binding}"
                                                        Style="{DynamicResource InlineSettingsButton}"
                                                        ToolTip="{x:Static properties:Resources.CustomSourceButtonEditTooltip}">
                                                        <mdicons:MaterialIcon Kind="{StaticResource IconEdit}" />
                                                    </Button>
                                                    <Button
                                                        Grid.Column="3"
                                                        Command="{Binding ElementName=RootPage, Path=DataContext.RemoveSourceCommand}"
                                                        CommandParameter="{Binding}"
                                                        Style="{DynamicResource InlineSettingsButton}"
                                                        ToolTip="{x:Static properties:Resources.CustomSourceButtonDeleteTooltip}">
                                                        <mdicons:MaterialIcon Kind="{StaticResource IconDelete}" />
                                                    </Button>
                                                </Grid>
                                            </DataTemplate>
                                        </ListView.ItemTemplate>
                                    </ListView>
                                    <Button
                                        Grid.Row="2"
                                        Command="{Binding AddNewSourceCommand}"
                                        Content="{x:Static properties:Resources.SettingsPageAddCustomSourceButton}"
                                        Style="{StaticResource SettingsButton}" />
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </Grid>
            <!--  LEFT COLUMN  -->
            <!--  THEME into EXPANDER with COMBOBOX and content of palette  -->

            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <Grid Margin="{StaticResource SmallTopBottomMargin}">
                    <StackPanel x:Name="ContentArea" Margin="{StaticResource MediumLeftRightMargin}">
                        <StackPanel>
                            <Border Style="{StaticResource SettingsItem}">
                                <StackPanel>
                                    <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{x:Static properties:Resources.SettingsPagePersonalizationTitle}" />
                                    <Border Style="{StaticResource SettingsItem}">
                                        <StackPanel>

                                            <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{x:Static properties:Resources.SettingsPageChooseThemeText}" />
                                            <Grid Margin="{StaticResource XSmallTopMargin}">
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="auto" />
                                                    <RowDefinition Height="auto" />
                                                    <RowDefinition Height="auto" />
                                                </Grid.RowDefinitions>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition Width="1*" />
                                                    <ColumnDefinition Width="1*" />
                                                </Grid.ColumnDefinitions>
                                                <mah:ColorPicker
                                                    Grid.RowSpan="2"
                                                    Grid.Column="1"
                                                    mah:TextBoxHelper.ClearTextButton="False"
                                                    mah:TextBoxHelper.UseFloatingWatermark="True"
                                                    mah:TextBoxHelper.Watermark="Select a color"
                                                    IsEnabled="{Binding Theme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=!System}"
                                                    IsRecentColorPaletteVisible="False"
                                                    SelectedColor="{Binding CurrentAccent, Delay=250}"
                                                    ToolTip="{x:Static properties:Resources.SettingsPageCustomColorTooltip}"
                                                    ToolTipService.ShowOnDisabled="True" />
                                                <Button
                                                    Grid.Row="2"
                                                    Grid.Column="1"
                                                    Command="{Binding ResetColorCommand}"
                                                    Content="Reset color"
                                                    ToolTip="{x:Static properties:Resources.SettingsPageCustomColorResetTooltip}"
                                                    ToolTipService.ShowOnDisabled="True" />
                                                <RadioButton
                                                    Background="Transparent"
                                                    Content="{x:Static properties:Resources.SettingsPageRadioButtonLightTheme}"
                                                    FontSize="{StaticResource MediumFontSize}"
                                                    GroupName="AppTheme"
                                                    IsChecked="{Binding Theme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Light}">
                                                    <i:Interaction.Triggers>
                                                        <i:EventTrigger EventName="Checked">
                                                            <i:InvokeCommandAction Command="{Binding SetThemeCommand}" CommandParameter="Light" />
                                                        </i:EventTrigger>
                                                    </i:Interaction.Triggers>
                                                </RadioButton>
                                                <RadioButton
                                                    Grid.Row="1"
                                                    Margin="{StaticResource XSmallTopMargin}"
                                                    Background="Transparent"
                                                    Content="{x:Static properties:Resources.SettingsPageRadioButtonDarkTheme}"
                                                    FontSize="{StaticResource MediumFontSize}"
                                                    GroupName="AppTheme"
                                                    IsChecked="{Binding Theme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=Dark}">
                                                    <i:Interaction.Triggers>
                                                        <i:EventTrigger EventName="Checked">
                                                            <i:InvokeCommandAction Command="{Binding SetThemeCommand}" CommandParameter="Dark" />
                                                        </i:EventTrigger>
                                                    </i:Interaction.Triggers>
                                                </RadioButton>
                                                <RadioButton
                                                    Grid.Row="2"
                                                    Margin="{StaticResource XSmallTopMargin}"
                                                    Background="Transparent"
                                                    Content="{x:Static properties:Resources.SettingsPageRadioButtonWindowsDefaultTheme}"
                                                    FontSize="{StaticResource MediumFontSize}"
                                                    GroupName="AppTheme"
                                                    IsChecked="{Binding Theme, Mode=OneWay, Converter={StaticResource EnumToBooleanConverter}, ConverterParameter=System}">
                                                    <i:Interaction.Triggers>
                                                        <i:EventTrigger EventName="Checked">
                                                            <i:InvokeCommandAction Command="{Binding SetThemeCommand}" CommandParameter="System" />
                                                        </i:EventTrigger>
                                                    </i:Interaction.Triggers>
                                                </RadioButton>
                                            </Grid>
                                        </StackPanel>
                                    </Border>
                                </StackPanel>
                            </Border>

                        </StackPanel>
                        <Border Style="{StaticResource SettingsItem}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{x:Static properties:Resources.SettingsPageOtherTitle}" />
                                <Button
                                    Grid.Row="1"
                                    Command="{Binding OpenInstallationFolderCommand}"
                                    Content="{x:Static properties:Resources.SettingsPageOpenInstallationFolderButton}"
                                    Style="{StaticResource SettingsButton}"
                                    ToolTip="{x:Static properties:Resources.SettingsPageOpenInstallationFolderButtonTooltip}" />
                                <Grid Grid.Row="2">
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="auto" />
                                        <ColumnDefinition Width="1*" />
                                    </Grid.ColumnDefinitions>
                                    <CheckBox
                                        Content="{x:Static properties:Resources.SettingsPageCheckForUpdatesOnStartup}"
                                        FontSize="16"
                                        IsChecked="{Binding AutoCheckForUpdates}"
                                        ToolTip="{x:Static properties:Resources.SettingsPageCheckForUpdatesOnStartupTooltip}" />
                                    <Button
                                        Grid.Column="1"
                                        Margin="10,5,0,0"
                                        Command="{Binding CheckForUpdatesCommand}"
                                        Content="{x:Static properties:Resources.SettingsPageCheckUpdatesButtonContent}"
                                        Style="{StaticResource SettingsButton}" />
                                </Grid>
                            </Grid>
                        </Border>
                        <Border Style="{StaticResource SettingsItem}">
                            <Grid x:Name="AssociationGrid" Margin="0,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="auto" />
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="auto" />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="auto" />
                                    <RowDefinition Height="auto" />
                                </Grid.RowDefinitions>
                                <Button
                                    Grid.RowSpan="2"
                                    Grid.Column="2"
                                    Command="{Binding AssociateAppWithExtensionsCommand}"
                                    Content="{x:Static properties:Resources.SettingsPageSetFileAssociationsButton}"
                                    Style="{StaticResource SettingsButton}"
                                    ToolTip="{x:Static properties:Resources.SettingsPageSetFileAssociationsButtonTooltip}" />
                                <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{x:Static properties:Resources.SettingsPageFileAssociationHeader}" />
                                <ItemsControl
                                    Grid.Row="1"
                                    Grid.ColumnSpan="2"
                                    d:ItemsSource="{d:SampleData ItemCount=5}"
                                    Focusable="False"
                                    ItemsSource="{Binding FileAssociationStatus}">
                                    <ItemsControl.Resources>
                                        <converters:BoolSelectorConverter
                                            x:Key="BoolIconKind"
                                            FalseValue="EmojiSadOutline"
                                            TrueValue="CheckOutline" />
                                        <converters:BoolSelectorConverter
                                            x:Key="BoolTooltip"
                                            FalseValue="{x:Static properties:Resources.SettingsPageFileAssociationExtensionTooltipFalse}"
                                            TrueValue="{x:Static properties:Resources.SettingsPageFileAssociationExtensionTooltipTrue}" />
                                        <converters:BoolSelectorConverter
                                            x:Key="BoolColor"
                                            FalseValue="Red"
                                            TrueValue="Green" />
                                    </ItemsControl.Resources>
                                    <ItemsControl.ItemsPanel>
                                        <ItemsPanelTemplate>
                                            <StackPanel Orientation="Horizontal" />
                                        </ItemsPanelTemplate>
                                    </ItemsControl.ItemsPanel>
                                    <ItemsControl.ItemTemplate>
                                        <DataTemplate DataType="{x:Type models:FileAssociationStatus}">
                                            <StackPanel
                                                Margin="5,0,10,5"
                                                Orientation="Vertical"
                                                ToolTip="{Binding Associated, Converter={StaticResource BoolTooltip}}">
                                                <TextBlock Style="{StaticResource SubtitleTextStyle}" Text="{Binding Extension}" />
                                                <mdicons:MaterialIcon Foreground="{Binding Associated, Converter={StaticResource BoolColor}}" Kind="{Binding Associated, Converter={StaticResource BoolIconKind}}" />
                                            </StackPanel>
                                        </DataTemplate>
                                    </ItemsControl.ItemTemplate>
                                </ItemsControl>
                                <mah:MetroProgressBar
                                    Grid.Column="1"
                                    Margin="30,0,30,10"
                                    EllipseDiameter="10"
                                    IsIndeterminate="True"
                                    Visibility="{Binding AssociationInProgress, Converter={StaticResource BoolToVisibilityConverter}}" />
                            </Grid>
                        </Border>
                        <Border Style="{StaticResource SettingsItem}">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="80" />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <TextBlock
                                    Grid.ColumnSpan="2"
                                    Style="{StaticResource SubtitleTextStyle}"
                                    Text="{x:Static properties:Resources.SettingsPageProcessMonitorHeader}" />
                                <mdicons:MaterialIcon Grid.Row="1" Kind="{Binding ProcessQuererType, Converter={StaticResource QuererToIconConverter}}" Margin="15" />
                                <TextBlock VerticalAlignment="Center"
                                    Grid.Row="1"
                                    Grid.Column="1"
                                    Style="{StaticResource BodyTextStyle}"
                                    Text="{Binding ProcessQuererType, Converter={StaticResource QuererToTextConverter}}" />
                            </Grid>
                        </Border>
                    </StackPanel>
                </Grid>
            </ScrollViewer>
        </Grid>
    </DockPanel>
</Page>
